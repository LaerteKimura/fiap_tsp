# üöö Sistema de Otimiza√ß√£o de Rotas com Algoritmos Gen√©ticos

Sistema completo de otimiza√ß√£o de rotas de entrega utilizando **Algoritmos Gen√©ticos** para resolver problemas de **TSP (Traveling Salesman Problem)** e **VRP (Vehicle Routing Problem)**, com an√°lise avan√ßada usando **Google Gemini AI**.

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)
![Status](https://img.shields.io/badge/Status-Production-success.svg)

---

## üìã √çndice

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Instala√ß√£o](#-instala√ß√£o)
- [In√≠cio R√°pido](#-in√≠cio-r√°pido)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [Algoritmos Gen√©ticos](#-algoritmos-gen√©ticos)
  - [Operadores de Muta√ß√£o](#operadores-de-muta√ß√£o)
  - [M√©todos de Sele√ß√£o](#m√©todos-de-sele√ß√£o)
  - [Tipos de Crossover](#tipos-de-crossover)
- [Modos de Opera√ß√£o](#-modos-de-opera√ß√£o)
  - [TSP - Problema do Caixeiro Viajante](#tsp---problema-do-caixeiro-viajante)
  - [VRP - Roteamento de Ve√≠culos](#vrp---roteamento-de-ve√≠culos)
- [An√°lise com IA](#-an√°lise-com-ia)
- [Controles e Interface](#-controles-e-interface)
- [Exemplos de Uso](#-exemplos-de-uso)
- [Arquivos de Dados](#-arquivos-de-dados)
- [Troubleshooting](#-troubleshooting)

---

## üéØ Caracter√≠sticas

- ‚úÖ **Dois modos de otimiza√ß√£o**: TSP (rota √∫nica) e VRP (m√∫ltiplas rotas)
- ‚úÖ **Algoritmos Gen√©ticos customiz√°veis**: 3 muta√ß√µes, 3 sele√ß√µes, 3 crossovers
- ‚úÖ **Visualiza√ß√£o em tempo real**: Mapa de S√£o Paulo com rotas animadas
- ‚úÖ **Sistema de prioridades**: Entregas alta (P0), m√©dia (P1) e baixa (P2)
- ‚úÖ **Restri√ß√µes realistas**: Capacidade de peso e autonomia de ve√≠culos
- ‚úÖ **An√°lise com IA**: Relat√≥rios executivos usando Google Gemini
- ‚úÖ **Exporta√ß√£o de dados**: JSON estruturado e relat√≥rios PDF
- ‚úÖ **Interface interativa**: Controles em tempo real e gr√°ficos de evolu√ß√£o

---

## üì¶ Instala√ß√£o

### 1. Requisitos do Sistema

- Python 3.8 ou superior
- pip (gerenciador de pacotes)
- 2GB de RAM dispon√≠vel
- Sistema operacional: Windows, Linux ou macOS

### 2. Clonar ou Baixar o Projeto

```bash
git clone https://github.com/LaerteKimura/fiap_tsp.git
cd otimizacao-rotas
```

### 3. Criar Ambiente Virtual (Recomendado)

**Linux/Mac:**
```bash
python3 -m venv venv
source venv/bin/activate
```

**Windows:**
```cmd
python -m venv venv
venv\Scripts\activate
```

### 4. Instalar Depend√™ncias

```bash
pip install -r requirements.txt
```

**Depend√™ncias principais:**
- `pygame` - Interface gr√°fica e visualiza√ß√£o
- `matplotlib` - Gr√°ficos de evolu√ß√£o
- `numpy` - Opera√ß√µes matem√°ticas
- `pandas` - Processamento de dados
- `reportlab` - Gera√ß√£o de PDFs
- `google-generativeai` - An√°lise com IA (opcional)

### 5. Verificar Instala√ß√£o

```bash
python --version  # Deve mostrar Python 3.8+
pip list          # Verifica pacotes instalados
```

---

## üöÄ In√≠cio R√°pido

### Execu√ß√£o B√°sica

```bash
python tsp.py
```

### Fluxo R√°pido (3 passos)

1. **Escolha o modo**
   - Pressione `A` para **analisar** solu√ß√£o existente
   - Pressione `N` para **criar nova** solu√ß√£o

2. **Configure o algoritmo** (se criando nova solu√ß√£o)
   - Escolha tipo de **Muta√ß√£o** (Swap, Inversion, Scramble)
   - Escolha m√©todo de **Sele√ß√£o** (Tournament, Roulette, Rank)
   - Escolha tipo de **Crossover** (OX, PMX, CX)

3. **Selecione o problema**
   - **TSP**: Rota √∫nica com um ve√≠culo
   - **VRP**: M√∫ltiplas rotas com v√°rios ve√≠culos

### Exemplo Completo (5 minutos)

```bash
# 1. Iniciar o sistema
python tsp.py

# 2. Escolher "N" (Nova solu√ß√£o)

# 3. Configurar algoritmo (exemplo):
#    - Muta√ß√£o: Swap
#    - Sele√ß√£o: Tournament
#    - Crossover: Order (OX)

# 4. Escolher modo VRP

# 5. Selecionar dep√≥sito (ou "Sem Dep√≥sito")

# 6. Aguardar otimiza√ß√£o (1-2 minutos)

# 7. Exportar solu√ß√£o: pressionar tecla "E"

# 8. Analisar: executar novamente e escolher "A"
```

---

## üìÅ Estrutura do Projeto

```
otimizacao-rotas/
‚îÇ
‚îú‚îÄ‚îÄ tsp.py                          # Script principal
‚îú‚îÄ‚îÄ vrp_solver.py                   # Solver VRP
‚îú‚îÄ‚îÄ genetic_algorithm.py            # Operadores gen√©ticos
‚îú‚îÄ‚îÄ route_analyzer.py               # An√°lise com IA
‚îú‚îÄ‚îÄ config.py                       # Configura√ß√µes globais
‚îÇ
‚îú‚îÄ‚îÄ ui_resources/
‚îÇ   ‚îú‚îÄ‚îÄ ga_menu_gui.py             # Menu de configura√ß√£o GA
‚îÇ   ‚îî‚îÄ‚îÄ ui_renderer.py             # Renderiza√ß√£o da interface
‚îÇ
‚îú‚îÄ‚îÄ loader_resources/
‚îÇ   ‚îú‚îÄ‚îÄ data_loader.py             # Carregador de dados
‚îÇ   ‚îú‚îÄ‚îÄ delivery_loader.py         # Loader de entregas
‚îÇ   ‚îú‚îÄ‚îÄ vehicle_loader.py          # Loader de ve√≠culos
‚îÇ   ‚îî‚îÄ‚îÄ city_loader.py             # Loader de cidades
‚îÇ
‚îú‚îÄ‚îÄ data_files/
‚îÇ   ‚îú‚îÄ‚îÄ deliveries.csv             # Entregas (id, rem√©dio, cidade, prioridade)
‚îÇ   ‚îú‚îÄ‚îÄ veiculos.csv               # Ve√≠culos (capacidade, autonomia, custo)
‚îÇ   ‚îú‚îÄ‚îÄ cidades_sp.tsv             # Dist√¢ncias entre cidades
‚îÇ   ‚îú‚îÄ‚îÄ worldcities.csv            # Coordenadas geogr√°ficas
‚îÇ   ‚îî‚îÄ‚îÄ geojs-35-mun.json          # GeoJSON de S√£o Paulo
‚îÇ
‚îú‚îÄ‚îÄ sp_map.py                       # Renderiza√ß√£o de mapa
‚îú‚îÄ‚îÄ vrp_details_renderer.py         # Detalhes das rotas
‚îú‚îÄ‚îÄ vrp_menu_gui.py                 # Menu VRP
‚îú‚îÄ‚îÄ route_helpers.py                # Fun√ß√µes auxiliares
‚îú‚îÄ‚îÄ draw_functions.py               # Fun√ß√µes de desenho
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt                # Depend√™ncias
‚îî‚îÄ‚îÄ README.md                       # Este arquivo
```

---

## üß¨ Algoritmos Gen√©ticos

O sistema utiliza **Algoritmos Gen√©ticos** para encontrar solu√ß√µes √≥timas ou pr√≥ximas do √≥timo. Voc√™ pode customizar tr√™s componentes principais:

### Operadores de Muta√ß√£o

A **muta√ß√£o** introduz diversidade gen√©tica na popula√ß√£o, evitando converg√™ncia prematura.

#### 1. **Swap Mutation** (Troca)

**Como funciona:**
- Seleciona duas posi√ß√µes aleat√≥rias na rota
- Troca as cidades nessas posi√ß√µes

**Exemplo:**
```
Antes:  [A, B, C, D, E, F]
Ap√≥s:   [A, D, C, B, E, F]
        (trocou B e D)
```

**Quando usar:**
- ‚úÖ Explora√ß√£o local eficiente
- ‚úÖ Bom para ajustes finos
- ‚úÖ Funciona bem com sele√ß√£o por torneio

**Par√¢metros:**
- Taxa de muta√ß√£o: 0.4 (40% de chance por gene)

---

#### 2. **Inversion Mutation** (Invers√£o)

**Como funciona:**
- Seleciona um segmento aleat√≥rio da rota
- Inverte a ordem das cidades nesse segmento

**Exemplo:**
```
Antes:  [A, B, C, D, E, F]
        (seleciona segmento C-D-E)
Ap√≥s:   [A, B, E, D, C, F]
        (inverte para E-D-C)
```

**Quando usar:**
- ‚úÖ √ìtimo para TSP
- ‚úÖ Resolve cruzamentos de rotas
- ‚úÖ Mant√©m adjac√™ncias locais

**Vantagens:**
- Pode desfazer "n√≥s" na rota
- Preserva boa parte da estrutura
- Menor impacto que Scramble

---

#### 3. **Scramble Mutation** (Embaralhamento)

**Como funciona:**
- Seleciona um segmento aleat√≥rio
- Embaralha completamente as cidades desse segmento

**Exemplo:**
```
Antes:  [A, B, C, D, E, F]
        (seleciona C-D-E)
Ap√≥s:   [A, B, D, E, C, F]
        (embaralha aleatoriamente)
```

**Quando usar:**
- ‚úÖ Alta explora√ß√£o
- ‚úÖ Escapar de m√≠nimos locais
- ‚úÖ Problemas muito complexos

**Aten√ß√£o:**
- ‚ö†Ô∏è Pode destruir boas solu√ß√µes
- ‚ö†Ô∏è Use taxa de muta√ß√£o menor (0.2-0.3)

---

### M√©todos de Sele√ß√£o

A **sele√ß√£o** determina quais indiv√≠duos se reproduzem, favorecendo os mais aptos.

#### 1. **Tournament Selection** (Sele√ß√£o por Torneio)

**Como funciona:**
1. Seleciona K indiv√≠duos aleatoriamente (K=3 padr√£o)
2. Escolhe os 2 melhores do torneio
3. Estes se tornam pais

**Exemplo:**
```
Popula√ß√£o: [A:100, B:80, C:120, D:90, E:110]
           (fitness menor √© melhor)

Torneio 1: [A:100, D:90, E:110] ‚Üí Vencedor: D (90)
Torneio 2: [B:80, C:120, E:110] ‚Üí Vencedor: B (80)

Pais selecionados: D e B
```

**Vantagens:**
- ‚úÖ **Simples e eficiente**
- ‚úÖ N√£o precisa ordenar toda popula√ß√£o
- ‚úÖ Press√£o seletiva ajust√°vel (via K)
- ‚úÖ Funciona bem com qualquer fun√ß√£o fitness

**Quando usar:**
- ‚úÖ **Recomendado para iniciantes**
- ‚úÖ Problemas de m√©dio porte
- ‚úÖ Boa diversidade + elitismo

**Par√¢metros:**
- K (tamanho do torneio): 3
- Maior K = mais press√£o seletiva

---

#### 2. **Roulette Wheel Selection** (Sele√ß√£o por Roleta)

**Como funciona:**
1. Inverte fitness (menor fitness = maior chance)
2. Calcula probabilidade proporcional ao fitness
3. Gira a "roleta" para escolher pais

**Exemplo:**
```
Popula√ß√£o: [A:100, B:80, C:120, D:90]

Fitness invertido:
A: 120-100 = 20
B: 120-80  = 40
C: 120-120 = 0
D: 120-90  = 30
Total: 90

Probabilidades:
A: 20/90 = 22%
B: 40/90 = 44%  ‚Üê Maior chance
C: 0/90  = 0%
D: 30/90 = 33%
```

**Vantagens:**
- ‚úÖ Sele√ß√£o proporcional ao fitness
- ‚úÖ Todos t√™m chance (diversidade)
- ‚úÖ Intuitivo de entender

**Desvantagens:**
- ‚ö†Ô∏è Pode convergir r√°pido se houver um super-indiv√≠duo
- ‚ö†Ô∏è Sens√≠vel √† escala do fitness

**Quando usar:**
- ‚úÖ Fitness bem distribu√≠do
- ‚úÖ Quer diversidade alta
- ‚úÖ Popula√ß√£o grande (100+)

---

#### 3. **Rank Selection** (Sele√ß√£o por Ranking)

**Como funciona:**
1. Ordena popula√ß√£o por fitness
2. Atribui ranks (1, 2, 3, ...)
3. Seleciona baseado no rank, n√£o no fitness

**Exemplo:**
```
Popula√ß√£o ordenada:
1. B: 80  ‚Üí Rank 1 (melhor)
2. D: 90  ‚Üí Rank 2
3. A: 100 ‚Üí Rank 3
4. C: 120 ‚Üí Rank 4 (pior)

Probabilidades baseadas em rank:
Rank 1: 4/10 = 40%
Rank 2: 3/10 = 30%
Rank 3: 2/10 = 20%
Rank 4: 1/10 = 10%
```

**Vantagens:**
- ‚úÖ **N√£o sofre com diferen√ßas extremas de fitness**
- ‚úÖ Press√£o seletiva constante
- ‚úÖ Evita converg√™ncia prematura

**Quando usar:**
- ‚úÖ Fitness com valores muito diferentes
- ‚úÖ Problemas com plat√¥s
- ‚úÖ Quer controle fino da press√£o seletiva

**Melhor para:**
- VRP com muitas restri√ß√µes
- Fitness com penalidades grandes

---

### Tipos de Crossover

O **crossover** combina caracter√≠sticas de dois pais para criar filhos.

#### 1. **Order Crossover (OX)** - Recomendado

**Como funciona:**
1. Seleciona segmento do Pai 1
2. Copia para o filho na mesma posi√ß√£o
3. Preenche o resto com cidades do Pai 2 na ordem

**Exemplo:**
```
Pai 1: [A, B, C, D, E, F, G, H]
Pai 2: [D, G, B, F, A, E, C, H]

Passo 1: Seleciona segmento (posi√ß√µes 3-5)
Filho:  [_, _, C, D, E, _, _, _]

Passo 2: Preenche com Pai 2 (D, G, B, F...)
         Pula C, D, E (j√° est√£o)
Filho:  [G, B, C, D, E, F, A, H]
```

**Vantagens:**
- ‚úÖ **Preserva ordem relativa**
- ‚úÖ Sempre gera solu√ß√µes v√°lidas
- ‚úÖ Melhor para TSP
- ‚úÖ Mant√©m "vizinhan√ßas" boas

**Quando usar:**
- ‚úÖ **Primeira escolha para TSP**
- ‚úÖ Prioridades importam
- ‚úÖ Sequ√™ncia √© cr√≠tica

---

#### 2. **Partially Mapped Crossover (PMX)**

**Como funciona:**
1. Seleciona segmento e copia do Pai 1
2. Cria mapeamento entre pais
3. Usa mapeamento para preencher resto

**Exemplo:**
```
Pai 1: [A, B, C, D, E, F, G, H]
Pai 2: [D, G, B, F, A, E, C, H]

Segmento (3-5):
Filho: [_, _, C, D, E, _, _, _]

Mapeamento:
C ‚Üî B (posi√ß√£o 3)
D ‚Üî F (posi√ß√£o 4)
E ‚Üî A (posi√ß√£o 5)

Preenche usando mapeamento:
Filho: [F, G, C, D, E, B, A, H]
```

**Vantagens:**
- ‚úÖ Preserva rela√ß√µes entre genes
- ‚úÖ Bom para estruturas complexas
- ‚úÖ Menos disruptivo que OX

**Quando usar:**
- ‚úÖ VRP com m√∫ltiplas rotas
- ‚úÖ Rela√ß√µes entre cidades importam
- ‚úÖ Estrutura hier√°rquica

---

#### 3. **Cycle Crossover (CX)**

**Como funciona:**
1. Come√ßa com primeira posi√ß√£o
2. Segue ciclos entre pais
3. Alterna pais a cada ciclo

**Exemplo:**
```
Pai 1: [A, B, C, D, E, F, G, H]
Pai 2: [D, G, B, F, A, E, C, H]

Ciclo 1: posi√ß√£o 0
A (Pai1) ‚Üí D (Pai2 pos0) ‚Üí D (Pai1 pos3) ‚Üí F (Pai2 pos3) ‚Üí F (Pai1 pos5) ‚Üí E (Pai2 pos5) ‚Üí E (Pai1 pos4) ‚Üí A (volta)

Filho: [A, _, _, D, E, F, _, _]

Preenche resto com Pai 2:
Filho: [A, G, B, D, E, F, C, H]
```

**Vantagens:**
- ‚úÖ Cada gene vem de um pai espec√≠fico
- ‚úÖ Preserva posi√ß√µes absolutas
- ‚úÖ √önico em sua abordagem

**Quando usar:**
- ‚úÖ Posi√ß√£o absoluta importa
- ‚úÖ Problemas com restri√ß√µes de ordem
- ‚úÖ Estruturas circulares

---

### üéØ Recomenda√ß√µes de Combina√ß√µes

| Problema | Muta√ß√£o | Sele√ß√£o | Crossover | Por qu√™ |
|----------|---------|---------|-----------|---------|
| **TSP Simples** | Swap | Tournament | OX | R√°pido e eficiente |
| **TSP com Prioridades** | Inversion | Tournament | OX | Preserva sequ√™ncias |
| **VRP Pequeno** | Swap | Tournament | PMX | Balanceado |
| **VRP Grande** | Inversion | Rank | PMX | Controle de press√£o |
| **Explora√ß√£o Alta** | Scramble | Roulette | CX | M√°xima diversidade |

---

## üó∫Ô∏è Modos de Opera√ß√£o

### TSP - Problema do Caixeiro Viajante

**Objetivo:** Encontrar a menor rota que visita todas as cidades exatamente uma vez.

**Caracter√≠sticas:**
- ‚úÖ Um √∫nico ve√≠culo
- ‚úÖ Uma √∫nica rota
- ‚úÖ Todas as cidades devem ser visitadas
- ‚úÖ Prioridades influenciam a ordem

**Restri√ß√µes:**
- Peso total ‚â§ Capacidade do ve√≠culo
- Dist√¢ncia total ‚â§ Autonomia do ve√≠culo

**Fun√ß√£o Fitness:**
```
fitness = dist√¢ncia_total 
        + penalidade_prioridade 
        + penalidade_peso (se exceder)
        + penalidade_dist√¢ncia (se exceder)
```

**Quando usar TSP:**
- ‚úÖ Um √∫nico ve√≠culo dispon√≠vel
- ‚úÖ Rota pequena/m√©dia (at√© 15 cidades)
- ‚úÖ Foco em ordem de visita
- ‚úÖ Aprendizado do algoritmo

**Exemplo de Solu√ß√£o TSP:**
```
Ve√≠culo: Caminh√£o Grande (5000kg, 800km)

Rota: S√£o Paulo ‚Üí Campinas ‚Üí Piracicaba ‚Üí 
      S√£o Carlos ‚Üí Ribeir√£o Preto ‚Üí Bauru ‚Üí 
      Sorocaba ‚Üí Santos ‚Üí S√£o Paulo

Dist√¢ncia: 724 km
Peso Total: 4.250 kg
Custo: R$ 2.172,00
Prioridades: 3x P0, 5x P1, 4x P2
```

---

### VRP - Roteamento de Ve√≠culos

**Objetivo:** Distribuir as cidades entre m√∫ltiplos ve√≠culos minimizando custo total.

**Caracter√≠sticas:**
- ‚úÖ M√∫ltiplos ve√≠culos
- ‚úÖ M√∫ltiplas rotas simult√¢neas
- ‚úÖ Cada cidade visitada uma vez
- ‚úÖ Dep√≥sito central (opcional)

**Restri√ß√µes:**
- Cada rota: peso ‚â§ capacidade do ve√≠culo
- Cada rota: dist√¢ncia ‚â§ autonomia do ve√≠culo
- Cada ve√≠culo usado no m√°ximo uma vez
- Se h√° dep√≥sito: todas rotas partem/retornam dele

**Fun√ß√£o Fitness VRP:**
```
fitness = Œ£(custo_rota_i)
        + penalidade_ve√≠culos_extras
        + penalidade_viola√ß√µes_capacidade
        + penalidade_prioridades_mal_sequenciadas
        + PENALIDADE_MASSIVA (se invi√°vel)
```

**Quando usar VRP:**
- ‚úÖ Muitas cidades (10+)
- ‚úÖ M√∫ltiplos ve√≠culos dispon√≠veis
- ‚úÖ Necessidade de otimizar frota
- ‚úÖ Problema real de log√≠stica

**Exemplo de Solu√ß√£o VRP:**
```
Dep√≥sito: S√£o Paulo

Rota 1 (Van - 1500kg, 400km):
  S√£o Paulo ‚Üí Guarulhos ‚Üí S√£o Jos√© dos Campos ‚Üí 
  Taubat√© ‚Üí S√£o Paulo
  Dist√¢ncia: 312km | Peso: 1.420kg | Custo: R$ 936

Rota 2 (Caminh√£o M√©dio - 3000kg, 600km):
  S√£o Paulo ‚Üí Sorocaba ‚Üí Campinas ‚Üí 
  Piracicaba ‚Üí S√£o Paulo
  Dist√¢ncia: 387km | Peso: 2.850kg | Custo: R$ 1.161

Rota 3 (Caminh√£o Grande - 5000kg, 800km):
  S√£o Paulo ‚Üí Santos ‚Üí Registro ‚Üí Iguape ‚Üí 
  Canan√©ia ‚Üí S√£o Paulo
  Dist√¢ncia: 542km | Peso: 3.200kg | Custo: R$ 1.626

Custo Total: R$ 3.723
Ve√≠culos: 3
Todas rotas vi√°veis: ‚úÖ
```

---

## ü§ñ An√°lise com IA

O sistema inclui an√°lise avan√ßada usando **Google Gemini AI** com embeddings.

### Configura√ß√£o

1. **Obter API Key:**
   - Acesse: https://makersuite.google.com/app/apikey
   - Crie ou selecione projeto
   - Copie a API Key

2. **Configurar vari√°vel de ambiente:**

**Linux/Mac:**
```bash
export GEMINI_API_KEY="sua_chave_aqui"
```

**Windows (CMD):**
```cmd
set GEMINI_API_KEY=sua_chave_aqui
```

**Windows (PowerShell):**
```powershell
$env:GEMINI_API_KEY="sua_chave_aqui"
```

### Como Usar

**Op√ß√£o 1: Menu Inicial**
```bash
python tsp.py
# Pressione "A" para an√°lise
```

**Op√ß√£o 2: An√°lise Direta**
```bash
python route_analyzer.py
```

### O que a An√°lise Gera

1. **Embeddings inteligentes** - Busca sem√¢ntica no contexto
2. **6 An√°lises especializadas:**
   - Resumo Executivo
   - An√°lise de Viabilidade
   - Distribui√ß√£o de Prioridades
   - Efici√™ncia de Custos
   - Pontos Cr√≠ticos
   - Recomenda√ß√µes

3. **Visualiza√ß√µes autom√°ticas:**
   - TSP: 4 gr√°ficos
   - VRP: 6 gr√°ficos

4. **Relat√≥rio PDF profissional**
   - Formata√ß√£o executiva
   - Tabelas e gr√°ficos integrados
   - An√°lises detalhadas

---

## üéÆ Controles e Interface

### Controles Durante Execu√ß√£o

#### Modo TSP
| Tecla | Fun√ß√£o |
|-------|--------|
| `G` | Toggle gr√°ficos de evolu√ß√£o |
| `L` | Toggle lista de cidades |
| `T` | Toggle visualiza√ß√£o de tentativas |
| `C` | Toggle coordenadas geogr√°ficas |
| `P` | Pausar/Continuar |
| `R` | Reiniciar popula√ß√£o |
| `E` | **Exportar solu√ß√£o para JSON** |
| `Q` | Sair |

#### Modo VRP
| Tecla | Fun√ß√£o |
|-------|--------|
| `G` | Toggle gr√°ficos de evolu√ß√£o |
| `L` | Toggle lista de rotas |
| `V` | Toggle cidades detalhadas |
| `D` | Toggle painel de detalhes |
| `C` | Toggle coordenadas |
| `P` | Pausar/Continuar |
| `R` | Recalcular solu√ß√£o VRP |
| `E` | **Exportar solu√ß√£o para JSON** |
| `Q` | Sair |

### Elementos da Interface

**Painel Esquerdo (400px):**
- Gr√°ficos de evolu√ß√£o (fitness e dist√¢ncia)
- Lista de cidades/rotas
- Informa√ß√µes de ve√≠culos
- M√©tricas em tempo real
- Controles e dicas

**√Årea Central (1080px):**
- Mapa de S√£o Paulo
- Cidades plotadas com cores de prioridade
- Rotas desenhadas (azul para TSP, cores diferentes para VRP)
- Anima√ß√£o em tempo real
- Legenda

**Painel Direito (800px - VRP com D):**
- Detalhes completos de cada rota
- Sequ√™ncia de cidades
- Estat√≠sticas por rota
- Alertas de viola√ß√µes
- Prioridades por entrega

---

## üí° Exemplos de Uso

### Exemplo 1: TSP B√°sico

```bash
# 1. Iniciar
python tsp.py

# 2. Menu inicial: pressionar "N"

# 3. Configura√ß√£o GA:
#    Muta√ß√£o: Swap
#    Sele√ß√£o: Tournament
#    Crossover: OX (Order)

# 4. Escolher: TSP

# 5. Aguardar 30-60 segundos

# 6. Observar:
#    - Fitness diminuindo
#    - Rota se otimizando no mapa
#    - Lista de cidades ordenadas

# 7. Exportar: pressionar "E"
#    Arquivo gerado: tsp_solution_YYYYMMDD_HHMMSS.json

# 8. Analisar (opcional):
#    python tsp.py ‚Üí "A" ‚Üí escolher arquivo
```

### Exemplo 2: VRP com Dep√≥sito

```bash
# 1. Iniciar
python tsp.py ‚Üí "N"

# 2. Configurar GA:
#    Muta√ß√£o: Inversion
#    Sele√ß√£o: Tournament
#    Crossover: PMX

# 3. Escolher: VRP

# 4. Selecionar dep√≥sito: "S√£o Paulo"

# 5. Aguardar 1-3 minutos

# 6. Observar:
#    - M√∫ltiplas rotas coloridas
#    - Cada ve√≠culo uma cor
#    - Dep√≥sito marcado com "D"

# 7. Detalhes: pressionar "D"
#    Ver todas rotas, cidades, pesos

# 8. Exportar: "E"
#    Arquivo: vrp_solution_YYYYMMDD_HHMMSS.json

# 9. Analisar:
#    python route_analyzer.py ‚Üí escolher arquivo
#    Relat√≥rio PDF gerado automaticamente
```

### Exemplo 3: Compara√ß√£o de Algoritmos

**Teste 1: Swap + Tournament**
```bash
python tsp.py ‚Üí N ‚Üí Swap, Tournament, OX ‚Üí TSP
# Anotar: Fitness final, tempo
```

**Teste 2: Inversion + Tournament**
```bash
python tsp.py ‚Üí N ‚Üí Inversion, Tournament, OX ‚Üí TSP
# Comparar resultados
```

**Teste 3: Scramble + Roulette**
```bash
python tsp.py ‚Üí N ‚Üí Scramble, Roulette, OX ‚Üí TSP
# Ver diferen√ßa na explora√ß√£o
```

---

## üìä Arquivos de Dados

### Estrutura dos CSVs

#### `deliveries.csv`
```csv
id,medicine_name,quantity,total_weight,city,location_name,priority
1,Paracetamol,100,15.5,S√£o Paulo,Hospital Central,0
2,Ibuprofeno,50,8.2,Campinas,Cl√≠nica Norte,1
...
```

**Campos:**
- `id`: Identificador √∫nico
- `medicine_name`: Nome do medicamento
- `quantity`: Quantidade de unidades
- `total_weight`: Peso total em kg
- `city`: Cidade destino
- `location_name`: Local espec√≠fico
- `priority`: 0 (alta), 1 (m√©dia), 2 (baixa)

#### `veiculos.csv`
```csv
id,name,max_capacity,max_distance,max_weight,cost_per_km
V1,Van Pequena,1500,300,1500,2.5
V2,Caminh√£o M√©dio,3000,600,3000,3.0
...
```

**Campos:**
- `id`: Identificador do ve√≠culo
- `name`: Nome descritivo
- `max_capacity`: Capacidade em kg
- `max_distance`: Autonomia em km
- `max_weight`: Peso m√°ximo em kg
- `cost_per_km`: Custo por quil√¥metro em R$

#### `cidades_sp.tsv`
```tsv
origem	destino	distancia
S√£o Paulo	Campinas	92.5
S√£o Paulo	Santos	72.3
...
```

**Campos (separados por TAB):**
- `origem`: Cidade origem
- `destino`: Cidade destino
- `distancia`: Dist√¢ncia real em km

### Personaliza√ß√£o de Dados

Para usar seus pr√≥prios dados:

1. **Mantenha o formato dos CSVs**
2. **Adicione cidades em `cidades_sp.tsv`**
3. **Configure coordenadas em `worldcities.csv`**
4. **Ajuste ve√≠culos conforme sua frota**

---

## üõ†Ô∏è Troubleshooting

### Problema: "Module 'pygame' not found"

**Solu√ß√£o:**
```bash
pip install pygame
```

### Problema: Pygame n√£o inicia janela

**Linux:**
```bash
sudo apt-get install python3-pygame
```

**Mac:**
```bash
brew install sdl2 sdl2_image sdl2_mixer sdl2_ttf
pip install pygame
```

### Problema: Erro ao carregar dados

**Verificar:**
- Pasta `data_files/` existe?
- Todos os CSVs est√£o presentes?
- Encoding UTF-8?

**Solu√ß√£o:**
```bash
ls data_files/
# Deve mostrar: deliveries.csv, veiculos.csv, etc.
```

### Problema: Fitness n√£o melhora

**Causas comuns:**
- Popula√ß√£o muito pequena (aumentar em `config.py`)
- Taxa de muta√ß√£o muito alta (diminuir)
- Problema sem solu√ß√£o vi√°vel

**Solu√ß√£o:**
```python
# config.py
POPULATION_SIZE = 200  # Aumentar
MUTATION_RATE = 0.3    # Ajustar
```

### Problema: VRP n√£o encontra solu√ß√£o vi√°vel

**Solu√ß√µes:**
1. Adicionar mais ve√≠culos em `veiculos.csv`
2. Aumentar capacidade dos ve√≠culos
3. Aumentar `VRP_GENERATIONS_PER_ROUTE` em `config.py`
4. Usar modo "Sem dep√≥sito"

### Problema: An√°lise com IA falha

**Verificar:**
1. API Key configurada?
   ```bash
   echo $GEMINI_API_KEY  # Linux/Mac
   echo %GEMINI_API_KEY% # Windows
   ```

2. Pacote instalado?
   ```bash
   pip install google-generativeai
   ```

3. Conex√£o com internet?

4. API Key v√°lida? (teste em https://makersuite.google.com)

---

## üìà Par√¢metros de Configura√ß√£o

### `config.py`

```python
# Tamanho da popula√ß√£o
POPULATION_SIZE = 100  # Aumentar para melhor qualidade

# Taxa de muta√ß√£o
MUTATION_RATE = 0.4    # 0.2-0.5 recomendado

# Peso de prioridade
PRIORITY_WEIGHT = 20   # Aumentar para for√ßar prioridades

# Gera√ß√µes VRP
VRP_GENERATIONS_PER_ROUTE = 100  # Aumentar para VRP complexo

# Interface
DEFAULT_SHOW_PLOT = True
DEFAULT_SHOW_LIST = True
```

### Ajuste Fino

**Para converg√™ncia r√°pida:**
```python
POPULATION_SIZE = 50
MUTATION_RATE = 0.3
```

**Para qualidade m√°xima:**
```python
POPULATION_SIZE = 200
MUTATION_RATE = 0.4
VRP_GENERATIONS_PER_ROUTE = 200
```

**Para problemas grandes:**
```python
POPULATION_SIZE = 150
MUTATION_RATE = 0.5
```

---

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Para contribuir:

1. Fork o projeto
2. Crie uma branch (`git checkout -b feature/MinhaFuncionalidade`)
3. Commit suas mudan√ßas (`git commit -m 'Adiciona nova funcionalidade'`)
4. Push para a branch (`git push origin feature/MinhaFuncionalidade`)
5. Abra um Pull Request

---

## üë• Autores

- Desenvolvido como projeto acad√™mico FIAP - Em desenvolvimento para estudos

---

## üôè Agradecimentos

- Dados de cidades: IBGE e GeoJSON
- Visualiza√ß√µes: Pygame e Matplotlib
- IA: Google Gemini API
- Inspira√ß√£o: Problemas reais de log√≠stica brasileira

---
