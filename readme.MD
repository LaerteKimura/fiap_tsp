# An√°lise de Rotas com Gemini AI

Sistema de an√°lise avan√ßada de solu√ß√µes de roteamento usando embeddings e IA generativa.

## üì¶ Instala√ß√£o

### Depend√™ncias Necess√°rias

```bash
# Instalar Google Generative AI
pip install -U google-generativeai

# Instalar ReportLab para gera√ß√£o de PDFs
pip install reportlab

# Instalar Matplotlib (se ainda n√£o tiver)
pip install matplotlib

# Instalar pandas e numpy (geralmente j√° inclu√≠dos)
pip install pandas numpy
```

### Configura√ß√£o da API Key

**Op√ß√£o 1: Vari√°vel de Ambiente (Recomendado)**

```bash
# Linux/Mac
export GEMINI_API_KEY="sua_chave_api_aqui"

# Windows (PowerShell)
$env:GEMINI_API_KEY="sua_chave_api_aqui"

# Windows (CMD)
set GEMINI_API_KEY=sua_chave_api_aqui
```

**Op√ß√£o 2: Inserir no prompt**

O sistema solicitar√° a chave se ela n√£o estiver configurada.

### Obter API Key do Gemini

1. Acesse: https://makersuite.google.com/app/apikey
2. Fa√ßa login com sua conta Google
3. Clique em "Get API Key"
4. Crie um novo projeto ou use um existente
5. Copie sua API Key

## üöÄ Como Usar

### Modo 1: Menu Inicial

```bash
python tsp.py
```

**Ao iniciar, voc√™ ver√°:**

- **Pressione A** - Analisar solu√ß√£o existente (abre route_analyzer)
- **Pressione N** - Criar nova solu√ß√£o (fluxo normal TSP/VRP)
- **ESC** - Sair

### Modo 2: An√°lise Direta

```bash
python route_analyzer.py
```

## üìä Fluxo de An√°lise

### 1. Sele√ß√£o de Arquivo

O sistema lista todos os arquivos JSON de solu√ß√£o no diret√≥rio:

```
üìÇ Arquivos de solu√ß√£o encontrados:
   1. tsp_solution_20250107_143022.json
   2. vrp_solution_20250107_145130.json
   
Escolha o arquivo para analisar (n√∫mero): 
```

### 2. Processamento

O sistema realiza automaticamente:

‚úÖ **Carregamento da solu√ß√£o**
- L√™ arquivo JSON
- Valida estrutura de dados
- Extrai metadados

‚úÖ **Gera√ß√£o de embeddings**
- Divide conte√∫do em chunks sem√¢nticos
- Gera embeddings usando `embedding-001`
- Armazena em cache para reuso

‚úÖ **An√°lise com Gemini**
- Usa embeddings para contexto relevante
- Gera 6 an√°lises especializadas:
  1. Resumo Executivo
  2. An√°lise de Viabilidade
  3. Distribui√ß√£o de Prioridades
  4. Efici√™ncia de Custos
  5. Pontos Cr√≠ticos
  6. Recomenda√ß√µes

‚úÖ **Cria√ß√£o de visualiza√ß√µes**
- Gr√°ficos de distribui√ß√£o
- An√°lises por rota (VRP)
- M√©tricas principais
- Utiliza√ß√£o de recursos

‚úÖ **Gera√ß√£o de PDF**
- Relat√≥rio completo estruturado
- Tabelas de metadados
- Visualiza√ß√µes integradas
- An√°lises detalhadas por se√ß√£o

### 3. Sa√≠da

```
‚úÖ AN√ÅLISE CONCLU√çDA COM SUCESSO!
====================================

üìÑ Relat√≥rio PDF: relatorio_tsp_20250107_150245.pdf
üìä Visualiza√ß√µes: tsp_analysis.png

```

## üìÑ Estrutura do Relat√≥rio

### Para TSP (Traveling Salesman Problem)

**Se√ß√µes:**
1. **Metadados** - Informa√ß√µes gerais da solu√ß√£o
2. **Visualiza√ß√µes** - 4 gr√°ficos principais:
   - Distribui√ß√£o de prioridades
   - Peso acumulado ao longo da rota
   - Prioridades por sequ√™ncia
   - M√©tricas principais
3. **Resumo Executivo** - Vis√£o geral da solu√ß√£o
4. **An√°lise de Viabilidade** - Verifica√ß√£o de restri√ß√µes
5. **Distribui√ß√£o de Prioridades** - An√°lise de ordena√ß√£o
6. **Efici√™ncia de Custos** - Otimiza√ß√£o de recursos
7. **Pontos Cr√≠ticos** - Identifica√ß√£o de problemas
8. **Recomenda√ß√µes** - Sugest√µes de melhorias

### Para VRP (Vehicle Routing Problem)

**Se√ß√µes:**
1. **Metadados** - Informa√ß√µes gerais (n√∫mero de rotas, dep√≥sito, etc.)
2. **Visualiza√ß√µes** - 6 gr√°ficos principais:
   - Custo por rota
   - Dist√¢ncia por rota
   - Peso por rota
   - Utiliza√ß√£o de ve√≠culos (peso e dist√¢ncia)
   - Viabilidade (pizza chart)
   - Distribui√ß√£o global de prioridades
3. **Resumo Executivo** - Vis√£o geral multi-rota
4. **An√°lise de Viabilidade** - Verifica√ß√£o por rota
5. **Distribui√ß√£o de Prioridades** - An√°lise global e por rota
6. **Efici√™ncia de Custos** - Otimiza√ß√£o e balanceamento
7. **Pontos Cr√≠ticos** - Gargalos operacionais
8. **Recomenda√ß√µes** - Melhorias espec√≠ficas por rota

## üéØ Funcionalidades Avan√ßadas

### Embeddings Inteligentes

O sistema usa embeddings para:
- **Busca sem√¢ntica** - Encontra contexto relevante para cada an√°lise
- **Cache eficiente** - Reutiliza embeddings j√° calculados
- **Top-K retrieval** - Seleciona os 5 chunks mais relevantes por query

### An√°lises Especializadas

Cada an√°lise √© gerada com:
- **Contexto relevante** - Baseado em embeddings
- **Dados completos** - Acesso ao JSON inteiro
- **Prompt especializado** - Pergunta espec√≠fica para cada se√ß√£o
- **Resposta estruturada** - Formato claro e acion√°vel

### Visualiza√ß√µes Customizadas

**Para TSP:**
- Barras de prioridade
- Linha de peso acumulado
- Scatter de prioridades por posi√ß√£o
- Barras de m√©tricas principais

**Para VRP:**
- Compara√ß√£o entre rotas
- Utiliza√ß√£o dupla (peso + dist√¢ncia)
- Viabilidade agregada
- Distribui√ß√£o consolidada

## ‚öôÔ∏è Configura√ß√µes Avan√ßadas

### Modelos Utilizados

```python
embedding_model = 'models/embedding-001'  # Para embeddings
generation_model = 'gemini-1.5-pro'       # Para an√°lise
```

### Par√¢metros de Retrieval

```python
top_k = 5  # N√∫mero de chunks mais relevantes por query
```

### Customiza√ß√£o de Prompts

Edite `route_analyzer.py` na fun√ß√£o `generate_analysis()`:

```python
queries = {
    'sua_analise': 'Sua pergunta personalizada aqui',
    # ...
}
```

## üêõ Troubleshooting

### Erro: "Module not found: google.generativeai"

```bash
pip install -U google-generativeai
```

### Erro: "API Key n√£o configurada"

Configure a vari√°vel de ambiente ou forne√ßa no prompt.

### Erro: "Arquivo JSON inv√°lido"

Certifique-se de exportar a solu√ß√£o usando a tecla **E** durante a execu√ß√£o.

### Erro: "ReportLab n√£o encontrado"

```bash
pip install reportlab
```

### Timeout ou erro 503 da API

- Aguarde alguns segundos e tente novamente
- Verifique se sua API Key est√° ativa
- Verifique limites de rate na sua conta Gemini

## üìù Exemplos de Uso

### Caso 1: An√°lise R√°pida

```bash
# 1. Execute o solver e exporte (pressione E)
python tsp.py

# 2. Analise o arquivo gerado
python route_analyzer.py
# Escolha o arquivo mais recente
```

### Caso 2: An√°lise em Lote

```bash
# Para analisar m√∫ltiplos arquivos
for file in tsp_solution_*.json; do
    python route_analyzer.py
    # Escolha cada arquivo
done
```

### Caso 3: Integra√ß√£o com Scripts

```python
from route_analyzer import RouteAnalyzer
import os

api_key = os.getenv('GEMINI_API_KEY')
analyzer = RouteAnalyzer(api_key)

analyzer.load_solution('minha_solucao.json')
chunks = analyzer.create_text_chunks()
df = analyzer.generate_embeddings(chunks)
analyses = analyzer.generate_analysis(df)
viz_files = analyzer.create_visualizations()
pdf_path = analyzer.generate_pdf_report(analyses, viz_files)

print(f"Relat√≥rio gerado: {pdf_path}")
```

## üîí Seguran√ßa

- **Nunca** commite sua API Key no c√≥digo
- Use vari√°veis de ambiente
- Mantenha `.env` no `.gitignore`
- Revogue keys vazadas imediatamente

## üìû Suporte

Para problemas ou d√∫vidas:

1. Verifique os logs do console
2. Confirme que todas as depend√™ncias est√£o instaladas
3. Valide o formato do JSON de entrada
4. Teste sua API Key com um script simples

## üöÄ Pr√≥ximas Funcionalidades

- [ ] Compara√ß√£o entre m√∫ltiplas solu√ß√µes
- [ ] Export para Excel al√©m de PDF
- [ ] Dashboard interativo web
- [ ] An√°lise temporal de evolu√ß√£o
- [ ] Sugest√µes autom√°ticas de re-otimiza√ß√£o
- [ ] Integra√ß√£o com banco de dados

## üìÑ Licen√ßa

Este m√≥dulo segue a mesma licen√ßa do projeto principal.
